<!DOCTYPE html>
<html>
<head>
    <title>PDF to Image Converter</title>
    <style>
        /* Loading spinner animation */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loader {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid #000;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        /* Progress bar styles */
        .progress {
            width: 100%;
            border: 1px solid #ccc;
            margin: 20px 0;
            position: relative;
        }
        .bar {
            width: 0;
            height: 30px;
            background-color: #4caf50;
            text-align: center;
            line-height: 30px;
            color: white;
            transition: width 0.3s ease;
        }
    </style>
    <script>
        function uploadFile() {
            var fileInput = document.getElementById('pdfInput');
            var file = fileInput.files[0];

            var formData = new FormData();
            formData.append('file', file);

            var imagesContainer = document.getElementById('images');
            imagesContainer.innerHTML = '<div class="loader"></div>'; // Show loading spinner

            var progressBar = document.getElementById('progressBar');
            progressBar.style.width = '0%'; // Reset progress bar

            fetch('http://localhost:3000', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => displayImages(data.data.files, imagesContainer))
            .catch(error => {
                console.error('Error:', error);
                imagesContainer.innerHTML = '<p>Failed to fetch data</p>'; // Display error message
            });
        }

        function displayImages(imagePaths, container) {
            container.innerHTML = ''; // Clear loading spinner

            imagePaths.forEach(path => {
                var img = document.createElement('img');
                img.style.width = '100%';
                img.style.marginBottom = '20px';
                container.appendChild(img);
            });
        }

        // Function to update progress bar based on upload progress
        function updateProgress(event) {
            if (event.lengthComputable) {
                var progressBar = document.getElementById('progressBar');
                var percent = (event.loaded / event.total) * 100;
                progressBar.style.width = percent + '%';
            }
        }
        
        // Attach an event listener to track the upload progress
        document.getElementById('pdfInput').addEventListener('change', function() {
            var fileInput = this.files[0];

            var formData = new FormData();
            formData.append('pdfFile', fileInput);

            var progressBar = document.getElementById('progressBar');
            progressBar.style.width = '0%'; // Reset progress bar

            var imagesContainer = document.getElementById('images');
            imagesContainer.innerHTML = '<div class="loader"></div>'; // Show loading spinner

            fetch('http://localhost:3000/api/v1/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    response.body.getReader().read().then(function processResult(result) {
                        if (result.done) {
                            imagesContainer.innerHTML = ''; // Clear loading spinner
                            return;
                        }

                        // Process result if needed
                        response.body.getReader().read().then(processResult);
                    });
                }
                return response.json();
            })
            .then(data => displayImages(data.data.files, imagesContainer))
            .catch(error => {
                console.error('Error:', error);
                imagesContainer.innerHTML = '<p>Failed to fetch data</p>'; // Display error message
            })
            .finally(() => {
                progressBar.style.width = '100%'; // Set progress bar to 100% when done
            });
        });
    </script>
</head>
<body>
    <h1>PDF to Image Converter</h1>
    <input type="file" id="pdfInput">
    <button onclick="uploadFile()">Upload and Convert</button>
    
    <div class="progress">
        <div id="progressBar" class="bar"></div>
    </div>

    <div id="images">
        <!-- Display converted images here -->
    </div>
</body>
</html>
